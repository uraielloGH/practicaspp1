{# templates/base.html.twig #}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}¡Bienvenido! - Inicio Brekky{% endblock %}</title>

        <link rel="icon" type="image/png" href="{{ asset('images/favicon.png') }}">

        {# ==== CSS global ==== #}
        <link rel="stylesheet" href="{{ asset('css/style.css') }}">

        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}
    </head>

    <body>

        {# ===== NAVBAR GLOBAL ===== #}
        <header class="main-nav">
            <div class="brekky-container main-nav__inner">

                <div class="main-nav__brand">
                    <a href="{{ path('app_home') }}">Brekky</a>
                </div>

                <nav class="main-nav__links">
                    {# enlaces de navegación principales #}
                    {% if app.user %}
                        <a href="{{ path('app_home') }}">Inicio</a>
                        <a href="{{ path('catalog_categories') }}">Productos</a>
                        <a href="{{ path('recommendations_survey') }}">Recomendaciones</a>
                        <a href="{{ path('store_index') }}">Tiendas cercanas</a>
                        <a href="{{ path('profile_edit') }}">Mi perfil</a>

                        {% if 'ROLE_ADMIN' in app.user.roles %}
                            <a href="{{ path('app_product_index') }}">Panel Admin</a>
                        {% endif %}
                    {% else %}
                        {# Lo que puede ver alguien NO logueado #}
                        <a href="{{ path('app_home') }}">Inicio</a>
                        <a href="{{ path('store_index') }}">Tiendas cercanas</a>
                    {% endif %}

                    {# zona derecha: usuario / login / registro #}
                    {% if app.user %}
                        <span class="main-nav__user">
                            Hola, {{ app.user.nombre }}
                        </span>
                        <a href="{{ path('app_logout') }}" class="main-nav__button">
                            Cerrar sesión
                        </a>
                    {% else %}
                        <a href="{{ path('app_login') }}">Iniciar sesión</a>
                        <a href="{{ path('app_register') }}" class="main-nav__button">
                            Registrarse
                        </a>
                    {% endif %}
                </nav>
            </div>
        </header>

        {# ===== CONTENIDO PRINCIPAL ===== #}
        <main>
            <div class="brekky-container">
                {% block body %}{% endblock %}
            </div>
        </main>

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    document.querySelectorAll('form.js-loading-form').forEach(function (form) {
                        form.addEventListener('submit', function () {
                            const btn = form.querySelector('button[type="submit"]');
                            if (btn) {
                                btn.classList.add('btn-loading');
                                btn.disabled = true;
                            }
                        });
                    });
                });
            </script>
        {% endblock %}
    </body>
</html>
